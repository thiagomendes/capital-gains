<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1054px" preserveAspectRatio="none" style="width:1470px;height:1054px;background:#FFFFFF;" version="1.1" viewBox="0 0 1470 1054" width="1470px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wewupe6mtnlj" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="832.3867" style="stroke:#A80036;stroke-width:1.0;" width="10" x="346.5" y="119.7988"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="651.5" y="149.1094"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="651.5" y="908.875"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="686.1445" style="stroke:#A80036;stroke-width:1.0;" width="10" x="825.5" y="201.4199"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1123.5" y="230.7305"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1351.5" y="274.041"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1351.5" y="385.9277"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="702.4551" style="stroke:#000000;stroke-width:2.0;" width="1217.5" x="239" y="178.1094"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="570.5234" style="stroke:#000000;stroke-width:2.0;" width="1197.5" x="249" y="303.041"/><rect fill="#FFFFFF" height="523.9023" style="stroke:none;stroke-width:1.0;" width="1197.5" x="249" y="349.6621"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="367.0156" style="stroke:#000000;stroke-width:2.0;" width="851.5" x="259" y="499.5488"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="249.1289" style="stroke:#000000;stroke-width:2.0;" width="831.5" x="269" y="523.8594"/><rect fill="#FFFFFF" height="202.5078" style="stroke:none;stroke-width:1.0;" width="831.5" x="269" y="570.4805"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="59.6211" style="stroke:#000000;stroke-width:2.0;" width="305" x="701.5" y="634.7461"/><rect fill="#FFFFFF" height="86.5762" style="stroke:none;stroke-width:1.0;" width="851.5" x="259" y="779.9883"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="88.4883" y2="970.1855"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="351" x2="351" y1="88.4883" y2="970.1855"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="656.5" x2="656.5" y1="88.4883" y2="970.1855"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="830.5" x2="830.5" y1="88.4883" y2="970.1855"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1128" x2="1128" y1="88.4883" y2="970.1855"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1356.5" x2="1356.5" y1="88.4883" y2="970.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="85.5352">User</text><ellipse cx="23.5" cy="15" fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,23 L23.5,50 M10.5,31 L36.5,31 M23.5,50 L10.5,65 M23.5,50 L36.5,65 " fill="none" filter="url(#f1wewupe6mtnlj)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="982.7207">User</text><ellipse cx="23.5" cy="995.6738" fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M23.5,1003.6738 L23.5,1030.6738 M10.5,1011.6738 L36.5,1011.6738 M23.5,1030.6738 L10.5,1045.6738 M23.5,1030.6738 L36.5,1045.6738 " fill="none" filter="url(#f1wewupe6mtnlj)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="141" x="279" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="286" y="73.5352">AppCommandLine</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="141" x="279" y="969.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="286" y="989.7207">AppCommandLine</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="86" x="611.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="618.5" y="73.5352">JsonParser</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="86" x="611.5" y="969.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72" x="618.5" y="989.7207">JsonParser</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="234" x="711.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="220" x="718.5" y="73.5352">OperationTaxCalculationService</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="234" x="711.5" y="969.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="220" x="718.5" y="989.7207">OperationTaxCalculationService</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="151" x="1051" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1058" y="73.5352">OperationConverter</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="151" x="1051" y="969.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137" x="1058" y="989.7207">OperationConverter</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="156" x="1276.5" y="53"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="1283.5" y="73.5352">OperationRepository</text><rect fill="#FEFECE" filter="url(#f1wewupe6mtnlj)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="156" x="1276.5" y="969.1855"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142" x="1283.5" y="989.7207">OperationRepository</text><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="832.3867" style="stroke:#A80036;stroke-width:1.0;" width="10" x="346.5" y="119.7988"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="651.5" y="149.1094"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="651.5" y="908.875"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="686.1445" style="stroke:#A80036;stroke-width:1.0;" width="10" x="825.5" y="201.4199"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1123.5" y="230.7305"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1351.5" y="274.041"/><rect fill="#FFFFFF" filter="url(#f1wewupe6mtnlj)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1351.5" y="385.9277"/><polygon fill="#A80036" points="334.5,115.7988,344.5,119.7988,334.5,123.7988,338.5,119.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="23.5" x2="340.5" y1="119.7988" y2="119.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="30.5" y="115.0566">Send a line with the operation list in json format</text><polygon fill="#A80036" points="639.5,145.1094,649.5,149.1094,639.5,153.1094,643.5,149.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="356.5" x2="645.5" y1="149.1094" y2="149.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="363.5" y="144.3672">Parse the json to a list of dto objects</text><polygon fill="#A80036" points="367.5,159.1094,357.5,163.1094,367.5,167.1094,363.5,163.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="655.5" y1="163.1094" y2="163.1094"/><path d="M239,178.1094 L313,178.1094 L313,185.1094 L303,195.1094 L239,195.1094 L239,178.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="702.4551" style="stroke:#000000;stroke-width:2.0;" width="1217.5" x="239" y="178.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="254" y="191.6777">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="169" x="328" y="190.7441">[for each item in the dtos list]</text><polygon fill="#A80036" points="813.5,197.4199,823.5,201.4199,813.5,205.4199,817.5,201.4199" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="356.5" x2="819.5" y1="201.4199" y2="201.4199"/><polygon fill="#A80036" points="1111.5,226.7305,1121.5,230.7305,1111.5,234.7305,1115.5,230.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="1117.5" y1="230.7305" y2="230.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="842.5" y="225.9883">Performs the conversion from dto to entity</text><polygon fill="#A80036" points="846.5,240.7305,836.5,244.7305,846.5,248.7305,842.5,244.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="840.5" x2="1127.5" y1="244.7305" y2="244.7305"/><polygon fill="#A80036" points="1339.5,270.041,1349.5,274.041,1339.5,278.041,1343.5,274.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="1345.5" y1="274.041" y2="274.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="842.5" y="269.2988">Save operation entity</text><polygon fill="#A80036" points="846.5,284.041,836.5,288.041,846.5,292.041,842.5,288.041" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="840.5" x2="1355.5" y1="288.041" y2="288.041"/><path d="M249,303.041 L311,303.041 L311,310.041 L301,320.041 L249,320.041 L249,303.041 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="570.5234" style="stroke:#000000;stroke-width:2.0;" width="1197.5" x="249" y="303.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="264" y="316.6094">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="326" y="315.6758">[if the type of operation is buy]</text><polygon fill="#A80036" points="367.5,337.6621,357.5,341.6621,367.5,345.6621,363.5,341.6621" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="824.5" y1="341.6621" y2="341.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="373.5" y="336.9199">Returns zero tax</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="249" x2="1446.5" y1="350.6621" y2="350.6621"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="176" x="254" y="361.2969">[if the type of operation is sell]</text><polygon fill="#A80036" points="1339.5,381.9277,1349.5,385.9277,1339.5,389.9277,1343.5,385.9277" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="1345.5" y1="385.9277" y2="385.9277"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="497" x="842.5" y="381.1855">Get the list of operations from the repository to calculate the weighted average</text><polygon fill="#A80036" points="846.5,395.9277,836.5,399.9277,846.5,403.9277,842.5,399.9277" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="840.5" x2="1355.5" y1="399.9277" y2="399.9277"/><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="877.5" y1="429.2383" y2="429.2383"/><line style="stroke:#A80036;stroke-width:1.0;" x1="877.5" x2="877.5" y1="429.2383" y2="442.2383"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.5" x2="877.5" y1="442.2383" y2="442.2383"/><polygon fill="#A80036" points="846.5,438.2383,836.5,442.2383,846.5,446.2383,842.5,442.2383" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="842.5" y="424.4961">Calculate the weighted average</text><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="877.5" y1="471.5488" y2="471.5488"/><line style="stroke:#A80036;stroke-width:1.0;" x1="877.5" x2="877.5" y1="471.5488" y2="484.5488"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.5" x2="877.5" y1="484.5488" y2="484.5488"/><polygon fill="#A80036" points="846.5,480.5488,836.5,484.5488,846.5,488.5488,842.5,484.5488" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="842.5" y="466.8066">Calculates total operation amount</text><path d="M259,499.5488 L321,499.5488 L321,506.5488 L311,516.5488 L259,516.5488 L259,499.5488 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="367.0156" style="stroke:#000000;stroke-width:2.0;" width="851.5" x="259" y="499.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="274" y="513.1172">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="146" x="336" y="512.1836">[if the operation has gain]</text><path d="M269,523.8594 L331,523.8594 L331,530.8594 L321,540.8594 L269,540.8594 L269,523.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="249.1289" style="stroke:#000000;stroke-width:2.0;" width="831.5" x="269" y="523.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="284" y="537.4277">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="344" x="346" y="536.4941">[if the operation is within the established limit (limit = 20k)]</text><polygon fill="#A80036" points="367.5,558.4805,357.5,562.4805,367.5,566.4805,363.5,562.4805" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="824.5" y1="562.4805" y2="562.4805"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="373.5" y="557.7383">Returns zero tax</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="269" x2="1100.5" y1="571.4805" y2="571.4805"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="268" x="274" y="582.1152">[if operation is not within the established limit]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="877.5" y1="606.7461" y2="606.7461"/><line style="stroke:#A80036;stroke-width:1.0;" x1="877.5" x2="877.5" y1="606.7461" y2="619.7461"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.5" x2="877.5" y1="619.7461" y2="619.7461"/><polygon fill="#A80036" points="846.5,615.7461,836.5,619.7461,846.5,623.7461,842.5,619.7461" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="842.5" y="602.0039">Calculate gain amount</text><path d="M701.5,634.7461 L763.5,634.7461 L763.5,641.7461 L753.5,651.7461 L701.5,651.7461 L701.5,634.7461 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="59.6211" style="stroke:#000000;stroke-width:2.0;" width="305" x="701.5" y="634.7461"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="716.5" y="648.3145">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156" x="778.5" y="647.3809">[if there is a loss to deduct]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="877.5" y1="673.3672" y2="673.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="877.5" x2="877.5" y1="673.3672" y2="686.3672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.5" x2="877.5" y1="686.3672" y2="686.3672"/><polygon fill="#A80036" points="846.5,682.3672,836.5,686.3672,846.5,690.3672,842.5,686.3672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="842.5" y="668.625">Discount loss from gain</text><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="877.5" y1="722.6777" y2="722.6777"/><line style="stroke:#A80036;stroke-width:1.0;" x1="877.5" x2="877.5" y1="722.6777" y2="735.6777"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.5" x2="877.5" y1="735.6777" y2="735.6777"/><polygon fill="#A80036" points="846.5,731.6777,836.5,735.6777,846.5,739.6777,842.5,735.6777" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="842.5" y="717.9355">Calculate tax from gain (aliquot = 20%)</text><polygon fill="#A80036" points="367.5,760.9883,357.5,764.9883,367.5,768.9883,363.5,764.9883" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="824.5" y1="764.9883" y2="764.9883"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="373.5" y="760.2461">Returns calculated tax</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="259" x2="1110.5" y1="780.9883" y2="780.9883"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="164" x="264" y="791.623">[if the operation has no gain]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="835.5" x2="877.5" y1="816.2539" y2="816.2539"/><line style="stroke:#A80036;stroke-width:1.0;" x1="877.5" x2="877.5" y1="816.2539" y2="829.2539"/><line style="stroke:#A80036;stroke-width:1.0;" x1="836.5" x2="877.5" y1="829.2539" y2="829.2539"/><polygon fill="#A80036" points="846.5,825.2539,836.5,829.2539,846.5,833.2539,842.5,829.2539" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="842.5" y="811.5117">Increments total loss</text><polygon fill="#A80036" points="367.5,854.5645,357.5,858.5645,367.5,862.5645,363.5,858.5645" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="824.5" y1="858.5645" y2="858.5645"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="373.5" y="853.8223">Returns zero tax</text><polygon fill="#A80036" points="639.5,904.875,649.5,908.875,639.5,912.875,643.5,908.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="356.5" x2="645.5" y1="908.875" y2="908.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="276" x="363.5" y="904.1328">Converts the list of objects to a list of dtos.</text><polygon fill="#A80036" points="367.5,918.875,357.5,922.875,367.5,926.875,363.5,922.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="361.5" x2="655.5" y1="922.875" y2="922.875"/><polygon fill="#A80036" points="34.5,948.1855,24.5,952.1855,34.5,956.1855,30.5,952.1855" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="28.5" x2="350.5" y1="952.1855" y2="952.1855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="40.5" y="947.4434">Returns the tax amounts to the user</text><!--MD5=[7fb43bcb847859622274aa7bc72c3e94]
@startuml

actor User

User -> AppCommandLine: Send a line with the operation list in json format

activate AppCommandLine

AppCommandLine -> JsonParser: Parse the json to a list of dto objects

activate JsonParser

JsonParser - -> AppCommandLine

deactivate JsonParser

loop for each item in the dtos list

AppCommandLine -> OperationTaxCalculationService

activate OperationTaxCalculationService

OperationTaxCalculationService -> OperationConverter: Performs the conversion from dto to entity

activate OperationConverter

OperationConverter - -> OperationTaxCalculationService

deactivate OperationConverter

OperationTaxCalculationService -> OperationRepository: Save operation entity

activate OperationRepository

OperationRepository - -> OperationTaxCalculationService

deactivate OperationRepository

alt if the type of operation is buy

OperationTaxCalculationService - -> AppCommandLine: Returns zero tax

else if the type of operation is sell

OperationTaxCalculationService -> OperationRepository: Get the list of operations from the repository to calculate the weighted average

activate OperationRepository

OperationRepository - -> OperationTaxCalculationService

deactivate OperationRepository

OperationTaxCalculationService -> OperationTaxCalculationService: Calculate the weighted average

OperationTaxCalculationService -> OperationTaxCalculationService: Calculates total operation amount

alt if the operation has gain

alt if the operation is within the established limit (limit = 20k)

OperationTaxCalculationService - -> AppCommandLine: Returns zero tax

else if operation is not within the established limit

OperationTaxCalculationService -> OperationTaxCalculationService: Calculate gain amount

alt if there is a loss to deduct

OperationTaxCalculationService -> OperationTaxCalculationService: Discount loss from gain

end

OperationTaxCalculationService -> OperationTaxCalculationService: Calculate tax from gain (aliquot = 20%)

OperationTaxCalculationService - -> AppCommandLine: Returns calculated tax

end

else if the operation has no gain

OperationTaxCalculationService -> OperationTaxCalculationService: Increments total loss

OperationTaxCalculationService - -> AppCommandLine: Returns zero tax

end

end

end

deactivate OperationTaxCalculationService

AppCommandLine -> JsonParser: Converts the list of objects to a list of dtos.

activate JsonParser

JsonParser - -> AppCommandLine

deactivate JsonParser

AppCommandLine - -> User: Returns the tax amounts to the user

deactivate AppCommandLine

@enduml

PlantUML version 1.2022.1(Tue Feb 01 15:19:58 BRT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: BR
--></g></svg>